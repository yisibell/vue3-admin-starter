import{bR as F,d as W,r as p,g as j,f as H,bS as ce,o as w,c as P,b as l,w as a,k,A as oe,a as R,bA as J,bz as Q,bK as L,by as B,bT as ne,bU as se,bB as X,q as Y,p as Z,t as G,v as ee,bV as ue,bW as re,E as le,bL as te,bC as ae,bJ as pe,bX as me,z as M,bO as _e,m as de,bY as ve,_ as fe,bZ as ge,bP as be}from"./index-Hn1QL0FG.js";import{a as ie,R as ye,p as he}from"./ResourceNode-SzwpaGIs.js";/* empty css                 *//* empty css                */const Ve=b=>F({url:"/roles",method:"get",params:b}),we=b=>F({url:`/roles/${b}`,method:"delete"}),ke=b=>F({url:`/roles/${b}`,method:"get"}),Ce=(b,$)=>F({url:`/roles/${b}`,method:"put",data:$}),xe=b=>F({url:"/roles",method:"post",data:b}),Ee=()=>F({url:"/permission",method:"get"}),Re={class:""},Se=W({__name:"DataAuthTable",props:{title:{default:"分配数据权限"},permisstionIds:{}},emits:["update:permisstionIds"],setup(b,{expose:$,emit:d}){const v=()=>({group_name:[],name:""}),U=b,C=d,i=p(v()),o=p([]),y=p([]),D=p(),f=j({get(){return U.permisstionIds},set(e){C("update:permisstionIds",e)}}),h=p(!1),x=j(()=>{const e=o.value.map(t=>t.group_name);return Array.from(new Set(e))}),T=()=>{y.value=o.value.filter(e=>{let t=!0,n=!0;const s=new RegExp(i.value.name);return i.value.name&&(t=s.test(e.name)),i.value.group_name.length&&(n=i.value.group_name.includes(e.group_name)),t&&n}),c()},I=()=>{i.value=v(),y.value=ne(o.value),c()},m=async()=>{try{h.value=!0;const{status:e,data:t}=await Ee();e===200&&(o.value=ne(t),I())}finally{h.value=!1}},c=()=>{se(()=>{y.value.forEach(e=>{var t;f.value.includes(e.id)&&((t=D.value)==null||t.toggleRowSelection(e,!0))})})},S=(e,t)=>{const n=f.value.findIndex(s=>s===t.id);n>=0?f.value.splice(n,1):f.value.push(t.id)},E=e=>{if(e.length){const t=e.map(n=>n.id);f.value=[...new Set([...f.value,...t])]}else y.value.forEach(t=>{const n=f.value.findIndex(s=>s===t.id);n>=0&&f.value.splice(n,1)})},K=({row:e,rowIndex:t,columnIndex:n})=>{if(n===1){const s=y.value[t-1];let g=y.value[t+1],V=1;if(!s||s.group_name!==e.group_name){for(;g&&g.group_name===e.group_name;)V++,g=y.value[t+V];return{rowspan:V,colspan:1}}else return{rowspan:0,colspan:0}}},_=()=>{i.value=v(),y.value=[]};return H(()=>{m()}),ce(()=>{_()}),$({init:m,reset:I,empty:_}),(e,t)=>{const n=ae,s=X,g=Y,V=Z,A=G,u=ee,z=ue,O=re,q=le,r=te;return w(),P("div",Re,[l(q,null,{header:a(()=>[k(oe(e.title),1)]),default:a(()=>[R("div",null,[l(u,{model:i.value,inline:!0},{default:a(()=>[l(g,{label:"权限分组",prop:"group_name"},{default:a(()=>[l(s,{modelValue:i.value.group_name,"onUpdate:modelValue":t[0]||(t[0]=N=>i.value.group_name=N),multiple:!0,clearable:!0},{default:a(()=>[(w(!0),P(J,null,Q(x.value,N=>(w(),B(n,{key:N,value:N,label:N},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"权限名称",prop:"name"},{default:a(()=>[l(V,{modelValue:i.value.name,"onUpdate:modelValue":t[1]||(t[1]=N=>i.value.name=N),clearable:!0},null,8,["modelValue"])]),_:1}),l(g,null,{default:a(()=>[l(A,{type:"primary",onClick:T},{default:a(()=>[k("查询")]),_:1}),l(A,{type:"danger",onClick:I},{default:a(()=>[k("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),L((w(),B(O,{ref_key:"tableVNode",ref:D,data:y.value,"span-method":K,"max-height":"630",border:"",onSelect:S,onSelectAll:E},{default:a(()=>[l(z,{type:"selection",width:"55",align:"center"}),l(z,{align:"center",label:"权限分组",prop:"group_name"}),l(z,{label:"权限名称",prop:"name"})]),_:1},8,["data"])),[[r,h.value]])]),_:1})])}}}),ze={class:"d-flex justify-space-between"},Ue={class:"role-editor-container"},Te={class:"role-editor__left"},Ie={class:"role-editor__right"},Ne=W({__name:"RoleEditor",props:{modelValue:{type:Boolean,default:!1},editingRow:{}},emits:["update:modelValue","success"],setup(b,{emit:$}){const d=()=>({name:"",description:"",type:0,order:0,permissions:[],resources:[]}),v=b,U=$,C=j({get(){return v.modelValue},set(_){U("update:modelValue",_)}}),i=p(),o=p(d()),y={name:[{required:!0,message:"请输入角色名称"}],type:[{required:!0,message:"请选择角色类型"}]},D=pe(),f=p([]),h=p(!1),x=p(),T=p(),I=async()=>{try{h.value=!0,f.value=await D.allResources()}finally{h.value=!1}},m=p(!1),c=async()=>{var _,e,t;try{if(m.value=!0,(_=v.editingRow)!=null&&_.id){const{status:n,data:s}=await ke(v.editingRow.id);n===200&&(o.value=Object.assign(d(),s),o.value.resources.forEach(g=>{var V;(V=x.value)==null||V.setChecked(g,!0,!1)}))}else o.value=d(),(e=x.value)==null||e.setCheckedKeys([]),(t=T.value)==null||t.empty();se(()=>{var n;(n=T.value)==null||n.init()})}finally{m.value=!1}},S=()=>{var t,n;const _=((t=x.value)==null?void 0:t.getCheckedKeys())||[],e=((n=x.value)==null?void 0:n.getHalfCheckedKeys())||[];return _.concat(e)},E=p(!1),K=()=>{var _;(_=i.value)==null||_.validate(async e=>{var t;if(e)try{E.value=!0,o.value.resources=S();let n;(t=v.editingRow)!=null&&t.id?n=await Ce(v.editingRow.id,o.value):n=await xe(o.value);const{status:s,data:g}=n;s===200&&(de.success("操作成功!"),C.value=!1,U("success",g))}finally{E.value=!1}})};return H(()=>{I()}),(_,e)=>{const t=G,n=Z,s=Y,g=ae,V=X,A=ve,u=ee,z=le,O=me,q=te;return w(),B(O,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=r=>C.value=r),"show-close":!1,direction:"rtl",size:"90%",onOpened:c},{header:a(()=>[R("div",ze,[R("div",null,oe(_.editingRow?"编辑角色":"新增角色"),1),R("div",null,[l(t,{type:"primary",loading:E.value,onClick:K},{default:a(()=>[k("提交")]),_:1},8,["loading"]),l(t,{type:"danger",onClick:e[0]||(e[0]=r=>C.value=!1)},{default:a(()=>[k("关闭")]),_:1})])])]),default:a(()=>[R("div",Ue,[R("div",Te,[l(z,{class:"mb-16"},{header:a(()=>[k("角色基础信息")]),default:a(()=>[l(u,{ref_key:"formVNode",ref:i,model:o.value,rules:y,"label-width":"90px"},{default:a(()=>[l(s,{label:"角色名称",prop:"name"},{default:a(()=>[l(n,{modelValue:o.value.name,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.name=r),maxlength:60,"show-word-limit":!0},null,8,["modelValue"])]),_:1}),l(s,{label:"角色类型",prop:"type"},{default:a(()=>[l(V,{modelValue:o.value.type,"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.type=r),style:{width:"100%"}},{default:a(()=>[(w(!0),P(J,null,Q(M(ie),r=>(w(),B(g,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"排序",prop:"order"},{default:a(()=>[l(A,{modelValue:o.value.order,"onUpdate:modelValue":e[3]||(e[3]=r=>o.value.order=r),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(s,{label:"角色描述",prop:"description"},{default:a(()=>[l(n,{modelValue:o.value.description,"onUpdate:modelValue":e[4]||(e[4]=r=>o.value.description=r),maxlength:200},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),l(z,null,{header:a(()=>[k("分配菜单权限")]),default:a(()=>[L((w(),P("div",null,[L((w(),B(M(_e),{ref_key:"resourceTreeVNode",ref:x,data:f.value,props:{label:"name",children:"sub"},"show-checkbox":"","default-expand-all":!1,"expand-on-click-node":!1,"highlight-current":"","node-key":"id"},{default:a(({data:r})=>[l(ye,{data:r},null,8,["data"])]),_:1},8,["data"])),[[q,h.value]])])),[[q,h.value]])]),_:1})]),R("div",Ie,[l(Se,{ref_key:"dataAuthTableVNode",ref:T,"permisstion-ids":o.value.permissions,"onUpdate:permisstionIds":e[5]||(e[5]=r=>o.value.permissions=r)},null,8,["permisstion-ids"])])])]),_:1},8,["modelValue"])}}}),$e=fe(Ne,[["__scopeId","data-v-90cbcf6e"]]),De={class:"view-container"},Ae={class:"d-flex justify-end"},Be={class:"d-flex justify-end py-16"},Le=W({name:"SystemRole",__name:"index",setup(b){const d=p({name:"",type:"",page:1,page_size:10}),v=p(!1),U=p(0),C=p([]),i=async()=>{try{v.value=!0;const m=he(d.value),{status:c,data:S}=await Ve(m);c===200&&(C.value=S.data,U.value=S.total)}finally{v.value=!1}},o=()=>{d.value.page=1,i()},y=m=>{d.value.page=m,i()},D=m=>{d.value.page_size=m,i()},f=p(null),h=p(!1),x=()=>{h.value=!0,f.value=null},T=m=>{h.value=!0,f.value=m},I=m=>{be.confirm("确定要删除吗?",{title:"温馨提示"}).then(async()=>{try{v.value=!0;const{status:c}=await we(m.id);c===200&&(de.success("删除成功!"),o())}finally{v.value=!1}})};return H(()=>{o()}),(m,c)=>{const S=Z,E=Y,K=ae,_=X,e=G,t=ee,n=le,s=ue,g=re,V=ge,A=te;return L((w(),P("div",De,[l(n,{class:"mb-16"},{default:a(()=>[l(t,{model:d.value,inline:!0},{default:a(()=>[l(E,{label:"角色名称",prop:"name"},{default:a(()=>[l(S,{modelValue:d.value.name,"onUpdate:modelValue":c[0]||(c[0]=u=>d.value.name=u)},null,8,["modelValue"])]),_:1}),l(E,{label:"角色类型",prop:"type"},{default:a(()=>[l(_,{modelValue:d.value.type,"onUpdate:modelValue":c[1]||(c[1]=u=>d.value.type=u)},{default:a(()=>[(w(!0),P(J,null,Q(M(ie),u=>(w(),B(K,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(E,null,{default:a(()=>[l(e,{type:"primary",onClick:o},{default:a(()=>[k("查询")]),_:1})]),_:1})]),_:1},8,["model"]),R("div",Ae,[l(e,{type:"primary",onClick:x},{default:a(()=>[k("新增角色")]),_:1})])]),_:1}),l(n,null,{default:a(()=>[l(g,{data:C.value,"max-height":"650px",border:""},{default:a(()=>[l(s,{label:"序号",type:"index",align:"center",width:"100"}),l(s,{label:"角色ID",prop:"id",align:"center",width:"120"}),l(s,{label:"角色名称",prop:"name",align:"center",width:"180"}),l(s,{label:"角色描述",prop:"description",align:"center"}),l(s,{label:"操作",align:"center",width:"160"},{default:a(({row:u})=>[l(e,{type:"primary",size:"small",onClick:z=>T(u)},{default:a(()=>[k("编辑")]),_:2},1032,["onClick"]),l(e,{type:"danger",size:"small",plain:"",onClick:z=>I(u)},{default:a(()=>[k("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),R("div",Be,[l(V,{"current-page":d.value.page,"onUpdate:currentPage":c[2]||(c[2]=u=>d.value.page=u),"page-size":d.value.page_size,"onUpdate:pageSize":c[3]||(c[3]=u=>d.value.page_size=u),total:U.value,layout:"total,sizes,pager",background:"",onCurrentChange:y,onSizeChange:D},null,8,["current-page","page-size","total"])]),l($e,{modelValue:h.value,"onUpdate:modelValue":c[4]||(c[4]=u=>h.value=u),"editing-row":f.value,onSuccess:i},null,8,["modelValue","editing-row"])])),[[A,v.value]])}}});export{Le as default};
